# Документ требований

## Введение

Данная функция реализует комплексное решение балансировки нагрузки с помощью HAProxy в образовательных целях, демонстрируя методы балансировки нагрузки как на 4-м уровне (TCP), так и на 7-м уровне (HTTP). Решение включает настройку нескольких веб-серверов Python и конфигурирование HAProxy для распределения трафика с использованием различных алгоритмов балансировки и правил маршрутизации.

## Требования

### Требование 1

**Пользовательская история:** Как системный администратор, я хочу настроить базовую балансировку нагрузки round-robin на 4-м уровне, чтобы равномерно распределять TCP-трафик между несколькими backend-серверами.

#### Критерии приемки

1. КОГДА запущены два простых HTTP-сервера Python на разных портах ТО оба сервера ДОЛЖНЫ быть доступны независимо
2. КОГДА HAProxy настроен с алгоритмом round-robin ТО трафик ДОЛЖЕН распределяться равномерно между двумя backend-серверами
3. КОГДА клиент делает несколько запросов к HAProxy ТО запросы ДОЛЖНЫ чередоваться между backend-серверами по принципу round-robin
4. КОГДА применяется конфигурация HAProxy ТО сервис ДОЛЖЕН запускаться без ошибок и слушать на настроенном порту

### Требование 2

**Пользовательская история:** Как системный администратор, я хочу реализовать взвешенную балансировку нагрузки round-robin на 7-м уровне, чтобы контролировать распределение трафика на основе мощности серверов и обрабатывать маршрутизацию для конкретных доменов.

#### Критерии приемки

1. КОГДА запущены три простых HTTP-сервера Python на разных портах ТО все три сервера ДОЛЖНЫ быть доступны независимо
2. КОГДА HAProxy настроен с алгоритмом weighted round-robin ТО первый сервер ДОЛЖЕН иметь вес 2, второй сервер вес 3, а третий сервер вес 4
3. КОГДА HTTP-запросы делаются с заголовком Host "example.local" ТО трафик ДОЛЖЕН распределяться согласно взвешенному алгоритму только на настроенные backend-серверы
4. КОГДА HTTP-запросы делаются без домена "example.local" ТО запросы НЕ ДОЛЖНЫ маршрутизироваться на backend-серверы
5. КОГДА активно взвешенное распределение ТО выбор сервера ДОЛЖЕН следовать соотношению 2:3:4 на протяжении нескольких запросов

### Требование 3

**Пользовательская история:** Как системный администратор, я хочу мониторить и проверять поведение балансировки нагрузки, чтобы подтвердить правильность работы конфигурации и задокументировать результаты.

#### Критерии приемки

1. КОГДА балансировка нагрузки активна ТО каждый запрос ДОЛЖЕН логироваться или отслеживаться для показа того, какой backend-сервер его обработал
2. КОГДА тестируется балансировка round-robin ТО скриншоты ДОЛЖНЫ демонстрировать чередующиеся ответы серверов
3. КОГДА тестируется взвешенная балансировка ТО скриншоты ДОЛЖНЫ демонстрировать паттерн взвешенного распределения
4. КОГДА тестируется маршрутизация для конкретного домена ТО скриншоты ДОЛЖНЫ показывать разное поведение для запросов с доменом example.local и без него
5. КОГДА создаются конфигурационные файлы ТО они ДОЛЖНЫ быть правильно отформатированы и содержать все необходимые директивы для указанного поведения балансировки нагрузки